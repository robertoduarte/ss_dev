******************************************************************************
���h�L�������g���      �F�e���C�u�����J�������t�@�C��
���t�@�C���L������      �Fmanstm.txt
���Ώۃ��C�u�����L�����́FSTM
���Ώۃ��C�u��������    �F�X�g���[���V�X�e�����C�u����
���o�[�W����            �F2.10
���쐬��                �FH.T
���쐬��                �F1996-02-01
�����̑��̃��b�Z�[�W    �F�Ȃ�
******************************************************************************

�@�ȉ��̏C���́A�t�@�C���V�X�e���ƃZ�b�g�ŏC�����Ă��܂��B
�@�t�@�C���V�X�e���̃o�[�W���� Ver.2.10 �ȍ~���g�p���Ă��������B

�P�D�@Ver.1.01����Ver.1.10�ւ̕ύX���e
�i�P�j�@�֐��d�l�̕ύX�_
�@(a) Ver.1.01�ȑO�̊֐��́A�ȉ��̂悤�ɒu�������Ă��������B
�@�@��STM_Init()
      #define GRP_MAX     12
      #define STM_MAX     24
�@  �@Uint32  work[STM_WORK_SIZE(GRP_MAX, STM_MAX)/sizeof(Uint32)];
              �E
              �E
�@�@  STM_Init(GRP_MAX, STM_MAX, work);
              �E
              �E
�@�@�@work�́A�S�o�C�g���E�ɔz�u���ĉ������B
    �@GFS_Init�֐��ɂ����铯���ɊJ���t�@�C���̍ő吔(open_max)��STM_MAX �ȏ��
    �@���邱�ƁB

�@�@��STM_OpenFid(grp, fid, &key), STM_OpenFrange(grp, &frange, &key)
�@�@�@STM_OpenFid(grp, fid, &key, STM_LOOP_READ);
�@�@�@STM_OpenFrange(grp, &frange, &key, STM_LOOP_READ);

�@�@��STM_SetTrBuf(stm, buf, BUF_SIZE)
�@�@�@STM_SetTrBuf(stm, buf, BUF_SIZE, STM_UNIT_WORD);

�@�@��STM_SetLoop(grp, stm)
�@�@�@���[�v�Đ�������ꍇ  �FSTM_SetLoop(grp, stm, STM_LOOP_ENDLESS);
�@�@�@���[�v�Đ������Ȃ��ꍇ�FSTM_SetLoop(grp, stm, 1);

�@(b) �G���[�֐��iStmErrFunc�j�̑�Q�����ɂ̓G���[�R�[�h���n����܂��B

�i�Q�j�@���[�v�Đ����̓���
�@�s�b�N�A�b�v���Đ��͈͂̏I�[�ɒB�����Ƃ��A���삪�ȉ��̂悤�ɈقȂ�܂��B

                �@�@�@�s�b�N�A�b�v���Đ��͈͂̏I�[�ɒB����
        �@�@�@Ver.1.01�ȑO      �@�@�@��        �@�@Ver.1.10�ȍ~
                �@����������������������������������������
                �@��                            �@�@�@�@��
�@�b�c�o�b�t�@���̑S�f�[�^�̓]�����@�@�@�s�b�N�A�b�v�����[�v�X�g���[���Ɉړ���
  ��������܂Ń|�[�Y����              �@�Đ����J�n����                        
                �@��                            �@�@�@�@��
  �X�e�[�^�X��STM_EXEC_COMPLETED�Ƃ��A�@STM_SetLoop�̎w��񐔂������[�v������ 
  �]��������Z�b�g����            �@�@�@�]��������Z�b�g����
                �@��                            �@�@�@�@��
�@�s�b�N�A�b�v�����[�v�X�g���[���Ɉړ��@�X�e�[�^�X��STM_EXEC_COMPLETED�Ƃ���
  ���Đ����J�n����

  Ver.1.01�p�ɍ쐬��������̃v���O�����́A��L�̕ύX�ɂ�����炸�A�E��̂悤��
STM_SetLoop(grp, STM_LOOP_DFL, 1)��}�����邱�Ƃœ��l�ɓ��삳���邱�Ƃ��ł���
���B

  grp = STM_OpenGrp();                    grp = STM_OpenGrp();
  stm = STM_OpenFid(grp, FID1, &key);     stm = STM_OpenFid(grp, FID1, &key,
  STM_SetTrBuf(stm, buf, BUFSIZE1);                           STM_LOOP_READ);
  STM_SetExecGrp(grp);                    STM_SetTrBuf(stm, buf, BUFSIZE1, 
  for (i = 0; i < LOOPMAX; ) {                                STM_UNIT_WORD);
      stat = STM_ExecServer();            STM_SetLoop(grp, STM_LOOP_DFL, 1);
      if (stat == STM_EXEC_COMPLETED) {   STM_SetExecGrp(grp);
          i++;                            for (i = 0; i < LOOPMAX; ) {
      }                                       stat = STM_ExecServer();
      user();                                 if (stat == STM_EXEC_COMPLETED) {
  }                                               i++;
                                                  STM_SetLoop(grp,
�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@�@STM_LOOP_DFL, 1);
                                              }
                                              user();
                                          }

�i�R�j�@�]���ݒ�
�@Ver.1.01�ȑO�ł́A�]���̈�̐ݒ聨�]���֐��̓o�^���]���֐��̏����������ꍇ�A
���̓]����͏��߂ɓo�^�����]���̈�ł����B�������AVer.1.10�ȍ~�ł́A�]���̈��
�ݒ肵�����K�v������܂��B�܂��A�ő�]���Z�N�^���A�]�����[�h�̓f�t�H���g��Ԃ�
�߂�܂��B

�i�S�j�@�e��t�@�C���̈���
�@CD-ROM�A�o�[�`����CD�ASIMM�ASCSI��̂��ׂẴt�@�C���̎�舵����sega_stm.lib
�ŉ\�ł��B�������A�����N����t�@�C���V�X�e�����C�u�����͎g��������K�v������
�܂��B

�i�T�j�@���̑�
�@(a) �X�g���[���V�X�e�����g�p���邽�߂ɂ́A�t�@�C���V�X�e���A�b�c�ʐM�C���^�t
�@�@�@�F�[�X�ADMA�A�L���b�V���̊e���C�u�����������N���Ȃ���΂Ȃ�܂���B
�@(b) sega_stm.h�ɕύX������܂��Bsega_stm.h���C���N���[�h���Ă���\�[�X�t�@�C
�@�@�@�������ׂčăR���p�C�����Ă��������B

�Q�D�@Ver.1.11�ȍ~�̕ύX���e�iVer.1.11�`Ver.1.13�܂Łj
�Q�D�P�@Ver.1.10����Ver.1.11�ւ̃o�O�C��
�@(a) �]���֐���(-1)�܂���(0)��Ԃ��ꍇ������Ƃ��̓���s�Ǒ΍�
�@(b) �Đ��͈͂̏I���ʒu���O�Ɍ���̃X�g���[�����I�[�v�������Ƃ��A�h���C�u����
�@�@�@����Ԃ̂܂�FAD���ω����Ȃ��Ȃ錻�ۂ̑΍�

�Q�D�Q�@Ver.1.11����Ver.1.12�ւ̃o�O�C��
�@(a) �Đ��͈͂̓r���Ńo�b�t�@�t���ɂȂ�ƃ��[�v�X�g���[���Ɉړ����錻�ۂ̑΍�

�Q�D�R�@Ver.1.12����Ver.1.13�ւ̃o�O�C��
�@(a) STM_SetExecGrp(NULL)�����s����ƁA�\���^�������[�v�^�t�@�C���V�X�e���ɂ�
�@�@�@��t�@�C���A�N�Z�X���ۂƂȂ錻�ۂ̑΍�

�R�D�@Ver.1.13����Ver.1.16�ւ̕ύX���e
�@�t�@�C���V�X�e���ƃo�[�W���������킹�邽��Ver.1.13�̌�AVer.1.16�Ƃ��܂����B

�R�D�P�@�������A�^�T�[�o���s�O���[�v�̎w��֐��̒ǉ�
�@STM_SetExecGrp�̓h���C�u���|�[�Y��ԂɂȂ�܂Ŋ֐����őҋ@���܂��B����ɂ��
�A�v�����̏����̒x���h�����߁A�ȉ��̊֐���ǉ����܂����B
�@STM_NwSetExecGrp���g�p���Ȃ��ꍇ�́A�ȉ��̕ύX�ɂ��e���͂���܂���B

�R�D�P�D�P�@�֐��̒ǉ�
������������������������������������������������������������������������������
��Title     ��Function                        ��Function Name       ��No    ��
���֐��d�l  �����ގ��s��ٰ�߂̎w��(�������A)  ��STM_NwSetExecGrp    ��7.1   ��
������������������������������������������������������������������������������
�m�����n  Bool   STM_NwSetExecGrp(StmGrpHn grp)
�m���́n  grp   �F�X�g���[���O���[�v�n���h��
�m�o�́n  �Ȃ�
�m�֐��l�nTRUE �F�������󂯕t����ꂽ�ꍇ
�@�@�@�@�@FALSE�F�������󂯕t�����Ȃ������ꍇ
�m�@�\�n
�@�X�g���[���T�[�o�����s���ׂ��X�g���[���O���[�v���w�肷��B
�@�������A�Ȃ̂ŁA�T�[�o�֐����Ăяo���K�v������B
�m���l�n
�@(a) ������o�^�����瑦�����A����B
�@(b) �t�@�C���V�X�e���g�p���邽��NULL���w�肵���ꍇ�́A�ȉ��̎菇�Ńh���C�u��
�@�@�@�|�[�Y��ԂɂȂ邱�Ƃ��m�F������AGFS�֐����Ăяo�����ƁB
        tsk = STM_NwSetExecGrp(grp);
        if (tsk == FALSE)  return;
        do {
            stat = STM_ExecServer();
            user();
        } while (stat != STM_EXEC_TSKEND);
�@(c) NULL���w�肵���ꍇ�A�X�g���[���T�[�o��STM_EXEC_TSKEND���o�R����STM_
�@�@�@EXEC_PAUSE�ɂȂ�B�K��STM_EXEC_TSKEND�ɂȂ�܂ŃT�[�o�֐����Ăяo�����ƁB
�@(d) �t�@�C���V�X�e��������ꍇ�ANULL���w�肵�Ē�~�����邱�ƁB
�@(e) �X�g���[���O���[�v�̃A�N�Z�X���ĊJ����ƒ�~�ʒu����ǂݍ��ݎn�߂�B

�R�D�P�D�Q�@�֐��d�l�̕ύX
������������������������������������������������������������������������������
��Title     ��Function                        ��Function Name       ��No    ��
���֐��d�l  ���T�[�o�̎��s                    ��STM_ExecServer      ��7.3   ��
������������������������������������������������������������������������������
�m�����n  Sint32�@STM_ExecServer(void)
�m���́n  �Ȃ�
�m�o�́n  �Ȃ�
�m�֐��l�n�X�g���[���A�N�Z�X��ԁiStmAcStat�j
�@�@�@�@�@�������A�^�֐��������̏ꍇ�A�֐��h�c�iStmFuncId�j
�@�@�@�@�@�G���[�̏ꍇ�A�G���[�R�[�h�iStmErrCode�j
�m�@�\�n
�@�X�g���[���T�[�o�����s����B

�R�D�P�D�R�@�萔�̕ύX
������������������������������������������������������������������������������
��Title     ��Function                        ��Function Name       ��No    ��
���f�[�^�d�l���X�g���[���A�N�Z�X���          ��StmAcStat           ��2.2   ��
������������������������������������������������������������������������������
�i�P�j�X�g���[���A�N�Z�X���
     ������������������������������������������������������������
     ��       �萔��  �@�@�@ ��         �@ ���@�@��            ��
     ������������������������������������������������������������
     ��STM_EXEC_COMPLETED�@  ���A�N�Z�X�I��                    ��
     ������������������������������������������������������������
     ��STM_EXEC_PAUSE�@�@�@  ���A�N�Z�X�ꎞ��~��              ��
     ������������������������������������������������������������
     ��STM_EXEC_DOING�@�@�@  ���A�N�Z�X��                      ��
     ������������������������������������������������������������
     ��STM_EXEC_WAIT �@�@�@  ���]���҂�                        ��
     ������������������������������������������������������������
     ��STM_EXEC_TSKEND�@�@   ���������A�^�֐��I��              ��
     ������������������������������������������������������������

�R�D�Q�@���̑��̕ύX
�R�D�Q�D�P�@STM_SetExecGrp�֐�
�@STM_NwSetExecGrp�̒ǉ��ɂ��킹�āASTM_SetExecGrp��Bool��Ԃ��悤�ɂ��܂����B
�֐��l�̈Ӗ���STM_NwSetExecGrp�Ɠ����ł��B

�R�D�Q�D�Q�@�֐��̒ǉ�
������������������������������������������������������������������������������
��Title     ��Function                        ��Function Name       ��No    ��
���֐��d�l  �����[�h�G���[�̃��J�o��          ��STM_Recover         ��9.3   ��
������������������������������������������������������������������������������
�m�����n  Sint32�@STM_Recover(void)
�m���́n  �Ȃ�
�m�o�́n  �Ȃ�
�m�֐��l�nSTM_ERR_OK  �F���J�o������
�@�@�@�@�@STM_ERR_CDRD�F���J�o�����s
�m�@�\�n
�@���[�h�G���[�����������ꍇ�ɋ����I�ɍĐ����p������B
�m���l�n
�@�G���[�֐����ňȉ��̂悤�Ɏg�p����B
        void    errfunc(void *obj, Sint32 ec)
        {
            if (ec == STM_ERR_CDRD) {
                STM_Recover();
            } else {
                �c�c
            }
        }

�R�D�R�@�o�O�C��
�@(a) �X�g���[���V�X�e���ɂ��ǂݍ��� �� �t�@�C���V�X�e���ɂ��ǂݍ��� ��
�@�@�@STM_SetExecGrp(grp) �� STM_SetExecGrp(NULL) �� STM_SetExecGrp(grp)�̏���
�@�@�@�������ꂽ�ꍇ�A�Ԉ�����͈͂��Đ����錻�ۂ̑΍�B
�@(b) STM_SetExecGrp(grp) ��  STM_ExecServer()�̊Ԃ�STM_GetExecStat(grp)���Ă�
�@�@�@�o�����ꍇ�A�Ԉ�����͈͂��Đ����錻�ۂ̑΍�B
�@(c) �X�g���[���O���[�v�̃A�N�Z�X��Ԃ�STM_EXEC_COMPLETED�ɂȂ�����A
�@�@�@STM_GetLenTrBuf�����s����ƂO��Ԃ����ۂ̑΍�B
�@(d) �ǂݍ��ݒ��ȊO��STM_MovePickup�����s�����ꍇ��STM_EXEC_PAUSE�ɂȂ錻�ۂ�
�@�@�@�΍�B
�@�@�@STM_MovePickup�ŋ����I�Ƀs�b�N�A�b�v���ړ�����ꍇ�ɂ��A�K�����[�v�񐔂�
�@�@�@�������w�肵�Ă��������B

�S�D�@Ver.1.16�ȍ~�̕ύX���e�iVer.1.16�`Ver.2.02�܂Łj
�S�D�P�@Ver.1.16����Ver.1.20�ւ̃o�O�C��
�@(a) �b�c�̃X�g���[�����Ȃ��X�g���[���O���[�v�����s�����ꍇ�A�X�e�[�^�X��
�@�@�@STM_EXEC_COMPLETED�Ȃ�����A���̂܂�STM_ExecServer���Ăё������
�@�@�@STM_EXEC_DOING�ɖ߂��Ă��܂����ۂ̑΍�B
�@(b) STM_SetLoop�Ń��[�v�񐔂��Q��ȏ�ɐݒ肵���ꍇ�A�풓�X�g���[�����P�x����
�@�@�@�]�����Ȃ����ۂ̑΍�B
�@(c) �t�@�C���T�C�Y���S�o�C�g�P�ʂłȂ��ꍇ�A���[�v�Đ����ɖ\�����錻�ۂ̑΍�
�@(d) �Đ����ɃX�g���[�����N���[�Y�������ʁA�ŏI�X�g���[���̍Đ��͈͂��Đ��J�n
�@�@�@�ʒu�����O���ɂȂ����ꍇ�A�Đ��͈͂̍Ō�܂ōĐ��������錻�ۂ̑΍�B

�S�D�Q�@Ver.1.20����Ver.1.21�ւ̕ύX���e
�S�D�Q�D�P�@�֐��̒ǉ�
������������������������������������������������������������������������������
��Title     ��Function                        ��Function Name       ��No    ��
���֐��d�l  ���X�g���[���V�X�e���̃��Z�b�g    ��STM_Reset           ��1.2   ��
������������������������������������������������������������������������������
�m�����n  void  STM_Reset(void)
�m���́n  �Ȃ�
�m�o�́n  �Ȃ�
�m�֐��l�n�Ȃ�
�m�@�\�n
�@�I�[�v�����Ă���X�g���[���O���[�v�ƃX�g���[����S�ăN���[�Y���A�X�g���[���V
�X�e�������Z�b�g����B(�X�g���[���̃A�N�Z�X�𒆎~���A�S�Ă̏�������������B)

�S�D�Q�D�Q�@���̑��̕ύX
�@(a) �K�v�ŏ����̊֐��i���L�̒��ӎ������Q�Ɓj�����́ASCU-DMA�]�����Ɏ��s���Ă�
�@�@�@A-Bus�փA�N�Z�X���Ȃ��悤�ɑΉ����܂����B
�@(b) CDC���C�u����Ver.1.20�ɑΉ����܂����B

�S�D�Q�D�R�@�o�O�C��
�@(a) �]���֐����g�p�����ꍇ�A�b�c�o�b�t�@�Ƀf�[�^������ɂ�������炸�A�]����
�@�@�@�\�Z�N�^�����ő�]���Z�N�^�������������Ȃ錻�ۂ̑΍�B
�@�@�@����ɔ����A�]���֐���o�^�����ꍇ�A�]�������f�[�^����STM_GetLenTrBuf��
�@�@�@����Ď擾���邱�Ƃ͂ł��Ȃ��Ȃ�܂����B
�@�@�@�f�[�^���̓A�v���P�[�V�������Ŏ擾���Ă��������B
�@(b) �Đ����̃X�g���[���O���[�v�ɑ�����X�g���[�����N���[�Y����ꍇ�̏������x
�@�@�@����i�������A�ǂݍ��ݒ��̃X�g���[�����N���[�Y����Ƃ��̏������Ԃ͓����j

�S�D�R�@Ver.1.21����Ver.1.22�ւ̃o�O�C��
�@(a) �X�g���[���O���[�v�Đ���A�s���ȃA�h���X�ɃA�N�Z�X�����Q���C�����܂����B

�S�D�S�@Ver.1.22����Ver.1.23�ւ̃o�O�C��
�@(a) �X�g���[���O���[�v���Đ����ɁA�����Đ��͈͂̃X�g���[���𕡐��I�[�v������
�@�@�@�ƁA�Đ��͈͂̐擪�Ƀs�b�N�A�b�v���ړ����Ȃ���Q���C�����܂����B

�S�D�T�@Ver.1.23����Ver.1.24�ւ̃o�O�C��
�@(a) �Đ����̃X�g���[�����N���[�Y������ɁA�O���̖��Đ��̃X�g���[���������I�[
�@�@�@�v������Ă���ꍇ�A�Ԉ�����o�b�t�@���Ƀf�[�^��ǂݍ��ޏ�Q���C������
�@�@�@�����B

�S�D�U�@Ver.2.00
�@(a) Ver.2.00�́AVer.1.24�Ɠ����ł��B

�S�D�V�@Ver.2.00����Ver.2.02�ւ̕ύX
�@�t�@�C���V�X�e���ƃo�[�W���������킹�邽��Ver.2.00�̌�AVer.2.02�Ƃ��܂����B

�S�D�V�D�P�@SGL CD-ROM���C�u�����Ƃ̓��ꉻ
�@(a) �R���p�C������USE_SGL���`���ăR���p�C������ƁASGL CD-ROM���C�u�����p��
�@�@�@���W���[���Ƃ��Ďg�p�ł���悤�ɂ��܂����B

�S�D�V�D�Q�@�o�O�C��
�@(a) STM_ExecServer�ɂ��Đ��J�n��ASTM_ExecTrans�œ]���������s�����Ƃ��Ă�
�@�@�@�ł��Ȃ���Q���C�����܂����B

�S�D�W�@Ver.2.02����Ver.2.10�ւ̕ύX
�@(a) �g���C�I�[�v���A�b�c�u���b�N��<FATAL>��Ԃ̌��o�@�\���������܂����B

�T�D�@���ӎ���
�i�P�j�@�]���֐���o�^���Ă���X�g���[���̃N���[�Y
�@�]���֐���(-1)��Ԃ�������ɃX�g���[�����N���[�Y����ƁA�]���֐����O�ȏ�̒l
��Ԃ��܂ŃX�g���[���V�X�e���͓]���֐����Ăё����܂��B�]�����I�������_�ŁA�O��
��̒l��Ԃ��Ă��������B

�i�Q�j�@SCU-DMA���g�p����ꍇ
�@�]�����[�h��STM_TR_SCU�̏ꍇ��A�]���֐���SCU-DMA���N�������ꍇ�A�X�g���[����
�ݍ��ݒ��͈ȉ��̊֐��������g�p�\�ł��B
�@SCU-DMA�]������A-Bus�A�N�Z�X�֎~�̂��߁A����ȊO�̊֐��͎g�p���֎~���܂��B
    �ESTM_Reset         �ESTM_CloseGrp      �ESTM_IsTrans
    �ESTM_ExecServer    �ESTM_ExecTrans     �ESTM_GetErrStat

***************************** end of file ************************************

